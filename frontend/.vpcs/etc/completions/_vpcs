#compdef vpcs
#autoload
_complete_debug
local curcontext="$curcontext"
local -a namespaces=(
  'init:initializers'
  'util:utilities'
  'install:installers'
  'sanity:sanity checks'
  'sys:system commands'
)
local -a namespace_titles=(init util install sanity sys)
local -a task_titles
local state line task namespace ret=1

_arguments -C '1:namespace:->namespaces' '2:task:->tasks' '*:: :->args' && ret=0

case "$state" in
  namespaces) _arguments -C '1: :($namespace_titles)' && _describe -t namespaces 'namespace' namespaces "$@" && ret=0 ;;
  tasks)
      curcontext="${curcontext%:*}-${namespace}:${curcontext##*:}"
      tasks=( $(vpcs list $namespace | sed -r 's/( )+-( )+/:/') )
      task_titles=($(vpcs list $namespace | awk '{ print $1};'))
      _arguments -C $task_titles && _describe -t tasks 'task' tasks && ret=0
      ;;
esac
return $ret
