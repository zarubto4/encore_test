#!/usr/bin/env bash
#- vpcs util next-configs <project> [--init] - sets project configs. --init will reset local files
ProjectLevel="json"
for i in $@; do
  case $i in
    --init) ProjectLevel="all";;
    *) Project="$i";;
  esac
done

ProjectDir=$(nx show project $Project | jq .root | sed -r 's/"//g')

if [[ -z "$ProjectDir" ]]; then
  vpcs log error "Project [$Project] not found!"
  exit 1
fi
vpcs nx2vpcs

if [[ "$ProjectLevel" = "all" ]]; then
  cp "$(locate template)/next/.env.local" "$ProjectDir"
  cp "$(locate template)/next/next.config.js" "$ProjectDir"
fi

yq "$(locate vpcs-config)" -o json | jq ".services.\"$Project\".features" > $ProjectDir/vpcs.config.json
cat $ProjectDir/vpcs.config.json | jq ".public.name=\"$Project\"" > $(locate tmp)/vpcs.config.json && mv $(locate tmp)/vpcs.config.json $ProjectDir/vpcs.config.json