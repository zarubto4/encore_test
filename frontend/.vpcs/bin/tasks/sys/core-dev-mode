#!/usr/bin/env bash
#- vpcs sys core-dev-mode:  excludes local files generated by setup.

update_gitexclude(){
  if [[ -z "$(git rev-parse --git-dir -- $NOERR)" ]]; then
    vpcs log critical "You do not appear to be in a git repository."
    exit 1
  fi
  cd $APP_ROOT
  ExcludeFN="$(realpath $(git rev-parse --git-dir))/info/exclude"

  if [[ ! -f "$ExcludeFN" ]]; then
    mkdir -p "$(realpath $(dirname "$ExcludeFN"))"
    touch $ExcludeFN
  fi
  if [[ -z "$(cat $ExcludeFN | grep "$1")" ]]; then
    vpcs log debug "Adding $1 to exclusion list..."
    echo "$1" >> $ExcludeFN
  else
    vpcs log debug "$1 already found in exclusion list."
  fi
  return 0;
}

update_gitexclude "nx.json"
update_gitexclude "docker-compose.yml"
update_gitexclude "pnpm-lock.yaml"
update_gitexclude "package.json"
update_gitexclude "vpcs.yml"
update_gitexclude "tsconfig.base.json"
update_gitexclude "dist"
update_gitexclude "tmp"

